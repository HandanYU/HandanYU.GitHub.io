---
layout: post
title: MySQL
summary: 本章讲述了MySQL的运行机制
featured-img: machine learning
language: chinese
category: MySQL
---

# IN vs. =

- 相同点：均在 WHERE 中使用作为筛选条件之一、均是等于的含义
- 不同点：IN 可以规定多个值，等于规定一个值

## 相互转化

```
select * from Websites where name in ('Google','菜鸟教程');
```

```
select * from Websites where name = 'Google' or name = '菜鸟教程';
```

## In 和 or 的效率比较

- 如果 in 和 or 所在列有索引或者主键的话，or 和 in 没啥差别，复杂度都是 O(1)
- 但如果没有索引的话，or 的复杂度是 O(n),in 的复杂度是 O(log n)

# count

## count(\*) 与 count(1)

- 一般情况下，Select Count (\*)和 Select Count(1)两着返回结果是一样的。
- 假如表没有主键(Primary key), 那么 count(1)比 count(\*)快，
- 相当于统计所有行数，不会忽略列值为 NULL。

## count(col)

- 只包括列名那一列，在统计结果的时候，会忽略列值为空。

# having vs. where

- 【分组前后】where 在分组前过滤，having 在分组后过滤，两者之间不冲突。
- 【使用聚合函数】where 查询条件中不可以使用聚合函数，而 having 查询条件中可以使用聚合函数
- 【使用字段别名】where 查询条件中不可以使用字段别名，而 having 查询条件中可以使用字段别名。

# '' vs. null vs. NULL

- ''是表示实际就是一个空字符串，不会被当作 null 被忽略
- null 与 NULL 一样，mysql 不区分大小写

# 不同的隔离级别

![image-1](/assets/img/post_img/isolation.png)

- Read Uncommitted (读取未提交内容)
  - 最低的隔离级别
  - 一个事务可以读到另一个事务未提交的结果
  - 所有的并发事务问题都会发生
- Read Committed (读取提交内容)
  - 只要在事务提交后，其更新结果才会被其他事务看见
  - 可以解决脏读问题
- Repeated Read (可重复读)
  - 在一个事务中，对于同一份数据的读取结果总是相同的，无论是否有其他事务对这份数据进行操作，以及这个事务是否提交。
  - 可以解决脏读，不可重复读
- Serialization (可串行化)
  - 最高的隔离级别
  - 事务串行化执行
  - 牺牲了系统的并发性
  - 可以解决并发事务的所有问题

# 什么是脏读

当一个事务正在访问数据，并且对数据进行了修改，但还没来得及提交到数据库中。这时，另一个事务也访问这个数据，然后使用了这个数据。

# 什么是幻读

一个事务在前后两次查询同一个范围的时候，后一次查询看到了前一次查询没有看到的数据行。

# SQL 优化方式

- 建立索引对查询进行优化
- 尽量避免全表扫描
- 调整数据结构设计
- 对于经常访问的数据库表建立索引
- 调整服务器内存分配
- 调整硬盘 I/O

# MySQL 删除语句

- drop 语句
  用于删除数据库和表 - `drop database db;` - `drop table tb;`
- delete 语句
  用来删除比表中的字段，内容 - `delete from tb where id=1;` - `delete from tb;`
- truncate
  来删除表中的所有字段 - `truncate table tb;`

# MySQL 中 CHAR 和 VARCHAR 的区别

## char

定长的类型，适合存储短的且固定的，如 MD5。

- 也就是假设设定为 char(10)，
  - 当传入[0,10]之间的字符，占的空间都是 10 个字节
  - 当传入的字符长度大于 10，则会截断超出的字符
- 取数据的时候，char 类型要 trim()去掉多余的空格

## varchar

变长型

- 存储大小为输入数据的字节的实际长度+1 或 2
- 取数据的时候，不需要去掉多余的空格

# MySQL 引擎

## InnoDB

- 是一个**事务型**的存储引擎
- 提供了对数据库 ACID 事务的支持
- 实现了 SQL 标准的四种隔离级别
- MySQL 运行 Innodb 时会在内存中建立缓冲池，用于缓冲数据和索引
- 适合处理多重并发的更新请求
- 支持自动增加列
- 属于 B+ Tree 索引结构
- 索引文件本身就是数据文件，即 B+ Tree 的数据域存储的就是实际的数据
- 数据文件本身就是主索引
- 辅助索引数据域存储的也是相应记录主键的值而不是地址，所以当以辅助索引查询时，会先根据辅助索引找到主键，再根据主键索引找到实际的数据
-

## Mylsam

列表的切片是产生新的内存地址；元组在[:]时是赋值，其余切片是产生新的内存地址

# 数据库优化

1. 查看 sql 语句的执行计划，内存消耗是否是否正常

2. 优化查询语句，减少 update 等低效率操作，减少多表一次性关联，减少嵌套语句等

3. 减少应用和数据库的交互次数、同一个 sql 语句的执行次数

4. 优化数据表结构，分析业务逻辑，对常用逻辑可提前计算好，减少重复查询

5. 对数据量大的表，可拆分做切片处理

# 数据仓库

一种面对主题的，相对稳定的，集成的，反应历史变化的数据集合

## 常用模型

- 范式建模
- 雪花模型
- 星形模型
- 事实星座模型

## ETL 过程

### E：Extract,数据提取

### T: Transform,数据转化

### L: Load, 数据加载

## 数据清洗

- 数据补缺：对空数据、缺失数据进行数据补缺操作，无法处理的做标记。
- 数据替换：对无效数据进行数据的替换。
- 格式规范化：将源数据抽取的数据格式转换成为便于进入仓库处理的目标数据格式。
- 主外键约束：通过建立主外键约束，对非法数据进行数据替换或导出到错误文件重新处理。

## 数据探索阶段

1)收集所有的源系统的文档、数据字典等内容。

2)收集源系统的使用情况，如谁在用、每天多少人用、占多少存储空间等内容。

3)判断出数据的起始来源（System-of-Record）。

4)通过数据概况（Data Profiling）来对源系统的数据关系进行分析。

# B+树

- 各个页之间是通过双向链表连接的
- 叶子节点中的数据是通过单向链表连接的

# 索引

## 索引的作用

- 加快数据检索速度
- 加快表之间的连接
- 通过唯一性索引可确保数据的唯一性
- 减少分组和排序的时间
- 适用优化隐藏器提高系统性能

## 索引的类别

### 唯一索引 vs. 主键

1、主键是一种约束，唯一索引是一种索引；

2、主键创建后一定包含一个唯一性索引，唯一性索引不一定是主键；

3、唯一性索引列允许空值， 主键不允许；

4、主键可被其他表引为外键，唯一索引不能；

5、一个表只能创建一个主键，但可创建多个唯一索引。

# 索引失效的情况

- order by中的列使用了聚合操作
- like查询以“%”开头
- or语句前后没有同时使用索引
- 在索引字段上使用“not”，“<>”，“!=”

# 数据库系统的三级模式结构
内模式，外模式，概念模式
- 第一层（内模式）和第三层（概念模式）不能直接发生关系
- 数据的**物理独立性**指的是：内模式改变，概念模式不变
- 数据的逻辑独立性指的是：概念模式改变，外模式和应用程序不变

# sql语言特点
面向集合操作方式，可嵌入高级语言中，语言简洁、功能强大

# 数据库语言
## DDL
数据库模式定义语言（create, alter, drop), 这些语句自动提交，无需用commit提交。

## DML
数据操纵语言（insert, delete, update）这些语句需要commit才能提交

## DCL 
数据库控制语言（grant, remove）

## DQL
数据库查询语言（select) 不存在commit问题

## DTL 
(事务控制语言) - Commit、Rollback事务提交与回滚语句

# 数据管理技术
## 人工管理阶段

- 数据不保存
- 数据无专门软件管理
- 数据不共享
- 数据不具备独立性

## 文件系统阶段

- 数据可以长期保存
- 文件系统管理数据
- 数据独立性较差
- 数据共享性差

# 数据库信息的运行安全采取的措施

- 风险分析
- 审计跟踪
- 备份与恢复
- 应急

# 解决死锁问题的方法

- 预防死锁
- 避免死锁
- 检测死锁
- 解除死锁

# 视图的更新操作规则
- 如果视图有一个基本关系的简单查询生成，而且它还包含了**基本关系中的主关键字**或是候选关键字，则可以通过这个视图进行更新操作。
- 不允许对涉及到**多个基本关系**的视图进行更新。
- 如果视图的生成中涉及到**聚集或是分组**操作，则不允许通过这个视图进行更新。

# 数据模型

- 网状
- 层次
- 关系

# 什么是数据元素

- 数据集合中的一个“个体”
- 数据的基本单位
- 一个结点
- 一个记录

# 其他问题

- 关系数据库，实现实体之间的联系是通过表与表之间的**公共属性（相同字段）**
- 数据库的**使用记录单**只是一个记录，**不能**进行插入操作，只能进行新建、删除、还原操作
- 对应关系代数中“投影”运算的语句是`select`
- 二维数组的行对应“元组”，列对应“属性”
- 与选择运算对应的命令动词是**where**
- sql与宿主语言的接口是**共享变量**
- 查询在运行过程中可以对原始表进行修改
- 当from子句中出现多个基本表或视图时，系统将根据where子句中的连接条件执行**笛卡尔积**操作

